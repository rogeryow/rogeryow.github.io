<!DOCTYPE html>
<html>
<head>
	<title></title>
	<style type="text/css">
		body {
			margin: 0;
			padding: 0 ;
		}
		iframe {
			width: 800px;
			height: 100vh;
		}
		button {
			border-radius: 5px;
			padding: 10px 20px;
			background-color: #FF5722;
    		color: #fff;
    		width: 125px;
    		margin-top: 2px;
		}
		.flex-container {
			display: flex;
		}
		.side {
			flex: 30%;
		}
		.content {
			flex: 70%;
		}
		iframe {
			border: 0;
		}
		ul {
			list-style-type: none;
			/*display: inline-block;*/
		}
		.header {
			background-color: #FF5722;
		}
		.header p {
			font-family: calibri;
			color: #fff;
			margin-left: 44px;
			margin-top: 0;
			margin-bottom: 0;
			padding: 17px 0;
			font-size: 18px;
		}
		select {
			margin-left: 45px;
			padding: 10px 5px;
		}
	</style>
</head>
<body>
	<div class="flex-container">
		<div class="side">
			<div class="header">
				<p>Testing Phase</p>
			</div>
			<img style="display: none" id="govLogo" src="img/govLogo2.jfif">
			<ul>
				<li>
					<button id="btnPDF">Print Preview</button>
				</li>
				<li>
					<button>Download</button>
				</li>
			</ul>
			<select>
				<option>Social Services</option>
				<option>Agriculture</option>
				<option>Agriculture</option>
			</select>
		</div>
		<div class="content">
			<iframe id="iframePDF" src=""></iframe>
		</div>
	</div>


<script src="https://cdn.jsdelivr.net/g/filesaver.js"></script>
<script src="https://unpkg.com/jspdf@1.5.3/dist/jspdf.min.js"></script>
<script src="https://unpkg.com/jspdf-autotable@3.2.11/dist/jspdf.plugin.autotable.js"></script>
<script src="js/main.js"></script>


<script type="text/javascript">
	btnPDF = document.getElementById('btnPDF')	
	let docs = {}	
	
	document.addEventListener('DOMContentLoaded', function() {
			pdfToIframe(docs.socialService(), 'iframePDF')
		// btnPDF.addEventListener('click', function() {
		// 	pdfToIframe(docs.socialService(), 'iframePDF')
		// 	pdfToWindow(docs.socialService())
		// })
	})

	function getBase64Image(img) {
		let canvas = document.createElement('canvas')
		canvas.width = img.width
		canvas.height = img.height
		let ctx = canvas.getContext('2d')
		ctx.drawImage(img, 0, 0)
		let dataURL = canvas.toDataURL('image/png')
		return dataURL.replace(/^data:image\/(png|jpg);base64,/, '')
	}

	class pageClass {
		size = {
			a4: [612, 950],
			legal: [612, 950],
			short: [612, 950],
		}
		leftMargin = 45
		constructor(format) {			
			if (this.size.hasOwnProperty(format)) {
				this.format = this.size[format]
			}else {
				this.format = this.size['a4']
				this.errorMsg = `'${format}' is an unrecognizable format. Please choose a defined format from the list []. Format will now be set to default 'A4' size`
				console.error(this.errorMsg)
			}
		}
		getWidth() {
			return this.format[0]
		}
		getHeight() {
			return this.format[1]
		}
		alignLeft() {
			return this.leftMargin
		}
		alignCenter() {
			return this.format[0]/2
		}
	}

	function docAddGovHeader(doc) {
		let govLogo = document.getElementById('govLogo')
		let base64GovLogo = getBase64Image(govLogo)
		doc.addImage(base64GovLogo, 'PNG', page.alignLeft(), 42, 80, 80)
		doc.setFontSize(11)
		doc.text('Republic of the Philippines', page.alignCenter(), offsetY, 'center')
		doc.text('Province of Davao del Sur', page.alignCenter(), offsetY+14, 'center')
		doc.setFontType('bold')
		doc.text('CITY OF DIGOS', page.alignCenter(), offsetY+31, 'center')
		doc.setFontSize(14)
		doc.text('OFFICE OF THE CITY MAYOR', page.alignCenter(), offsetY+48, 'center')
		doc.setFontSize(11)
		doc.text('CITY SPECIAL PROGRAM AND MANAGEMENT OFFICE', page.alignCenter(), offsetY+62, 'center')
		doc.setFontSize(14)
		let header = 'SOCIAL SERVICES' 
		doc.text(header, page.alignCenter(), offsetY+78, 'center')
		doc.line(page.alignLeft()+198, 131, page.getWidth()-243, 131)
		doc.setFontType('normal')
		doc.setFontSize(12)
		let strDate = 'Date: ______________'
		let strDateSize = doc.getTextWidth(strDate)
		doc.text(strDate, page.getWidth()-(strDateSize+page.leftMargin), offsetY+95,)
	}

	docs.socialService = function() {
		page = new pageClass('legal')
		offsetY = 50
		let doc = new jsPDF('portrait', 'pt', page.format)

		docAddGovHeader(doc)
		doc.setFontSize(10)
		doc.setFontType('bold')
		doc.text('SOCIAL CASE STUDY', page.alignCenter(), offsetY+115, 'center')
		doc.setFontSize(13)
		doc.text('I.', page.alignLeft(), 210)
		let strHeadMargin = 30
		doc.text('IDENTIFYING DATA', page.alignLeft()+strHeadMargin, 210)
		doc.setFontSize(12)
		doc.setFontType('normal')
		strSpacing = 15
		doc.text('Name: Roger Pantil',page.alignLeft()+strHeadMargin, 238)
		doc.text('Age: 16',page.alignLeft()+strHeadMargin, 238+strSpacing)
		doc.text('Sex: Male',page.alignLeft()+strHeadMargin, 238+strSpacing*2)
		doc.text('Civil Status: Single',page.alignLeft()+strHeadMargin, 238+strSpacing*3)
		doc.text('Date of Birth: 05/09/94',page.alignLeft()+strHeadMargin, 238+strSpacing*4)
		doc.text('Place of Birth: Digos City',page.alignLeft()+strHeadMargin, 238+strSpacing*5)
		doc.text('Educational Attainment: Bachelor in Information Technology',page.alignLeft()+strHeadMargin, 238+strSpacing*6)
		doc.text('Occupation & Income: Programmer & 280 daily ;)',page.alignLeft()+strHeadMargin, 238+strSpacing*7)
		doc.text('Net Income: 4,000',page.alignLeft()+strHeadMargin, 238+strSpacing*8)


		// doc.autoTable({
		// 	startY: 150,
		// 	head: [
		// 	[['Name'],['Age'],['Sex'],['Civil Status'],['Occupation'],['Income']]
		// 	],
		// 	body: [['Roger Pantil']],
		// 	theme: 'plain',	
		// 	styles: {
		// 		overflow: 'linebreak',
		// 		halign: 'justify',
		// 		fontSize: 12,
		// 	}
		// })
		return doc
	}

	docs.agriculture = function() {

	}

	function pdfDownload(doc) {
		doc.save('autoprint.pdf')
	}

	function pdfToWindow(doc) {
		// doc.autoPrint({letiant: 'non-conform'});
		doc.output('dataurlnewwindow')
	}

	function pdfToIframe(doc, iframeID) {
		let blob = doc.output('blob')
		let blobURL = URL.createObjectURL(blob)
		iframePDF = document.getElementById(iframeID)
		iframePDF.src = blobURL
	}
</script>
</body>
</html>

